
# Compilation and installation of Blitz++ (+patch)
IF (NOT BLITZ_INSTALLED)
 MESSAGE("----------------------------------")
 MESSAGE("              Blitz++             ")
 MESSAGE("----------------------------------")
 MESSAGE("I am now compiling Blitz++ for your system. This will happen only at the first invocation of cmake. Patience.... ")
 SET(fff ${CMAKE_CURRENT_BINARY_DIR}/BlitzCompile.sh)
 FILE(WRITE ${fff} "cp  ${CMAKE_CURRENT_SOURCE_DIR}/blitz_source.tgz ${CMAKE_CURRENT_BINARY_DIR}\n")
 FILE(APPEND ${fff} "cd ${CMAKE_CURRENT_BINARY_DIR}; tar xvzf  blitz_source.tgz >tar.log 2>&1\n" )
 FILE(APPEND ${fff} "export CXX=${CMAKE_CXX_COMPILER}\n")
 FILE(APPEND ${fff} "export CXXFLAGS=\"${CMAKE_CXX_FLAGS}\"\n")
 FILE(APPEND ${fff} "export CXX_IS_GNU=${CMAKE_COMPILER_IS_GNUCXX}\n")
 FILE(APPEND ${fff} "cd blitz-0.9_CorrectedbyOPForICCBUG-ClangWarn\n")
 #FILE(APPEND ${fff} "cd blitz-0.9_CorrectedbyOPForICCBUG\n")
 FILE(APPEND ${fff} "echo Configuring Blitz : may take a while....\n")
 FILE(APPEND ${fff} "./configure --prefix=${CMAKE_CURRENT_BINARY_DIR}/BlitzInstallation --disable-doxygen --disable-cxx-flags-preset > ConfiguringLog 2>&1 \n")
 FILE(APPEND ${fff} "echo Compiling  .....\n")
 FILE(APPEND ${fff} "make install > InstallLog 2>&1 \n")
 #EXECUTE_PROCESS(COMMAND cat ${fff} )
 EXECUTE_PROCESS(COMMAND bash ${fff} > BlitzCompileLog 2>&1 )
 SET(BLITZ_INSTALLED TRUE CACHE BOOLEAN "Blitz is compiled")
 MESSAGE("... done")
 #SET(BLITZ_LIBRARIES  ${CMAKE_CURRENT_BINARY_DIR}/BlitzInstallation/lib CACHE STRING "Blitz libraries")
 SET(BLITZ_LIBRARY  ${CMAKE_CURRENT_BINARY_DIR}/BlitzInstallation/lib/libblitz.a CACHE STRING "Blitz library (static)")
 SET(BLITZ_INCLUDE  ${CMAKE_CURRENT_BINARY_DIR}/BlitzInstallation/include CACHE STRING "Blitz include")
 mark_as_advanced(BLITZ_INSTALLED BLITZ_LIBRARY BLITZ_INCLUDE)
ENDIF (NOT BLITZ_INSTALLED)

